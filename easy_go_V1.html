<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Easy Go!</title>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css">
<script src="http://code.jquery.com/jquery-1.7.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
<script src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true"></script>
<style>
#page_1{ width: 100%; height:100%; padding: 0;background: #000000; }
#map-page{ width: 100%; padding: 0;background: #000000; height:100%;}
#map-canvas {width: 100%; padding: 0;}

.img-responsive {
display: block;
max-width: 100%;
}

#lgo{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:66px;
	width:353px;
}

#lgo_go{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:383px;
	width:431px;
}

#lgo_his{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:95px;
	width:443px;
}

#lgo_set{
	margin-top:40px;
	margin-left:auto;
	margin-right:auto;
	height:96px;
	width:443px;
}

</style>
</head> 
<body> 

<div data-role="page" id="page_1">

<div data-role="content">

<img class="img-responsive" src="logo.png" id="lgo">
<a href="#map-page" data-transition="slide"><img class="img-responsive" src="GO-button_03.png" id="lgo_go"></a>
<img class="img-responsive" src="history_log_03.png" id="lgo_his">
<img class="img-responsive" src="setting_03.png" id="lgo_set">


</div>	
</div>



<div data-role="page" id="map-page">
	<div data-role="content" style="height:33px;padding-top:0px;overflow:hidden;" id="hdr"> 
		  <div  class="ui-grid-b">
            <div class="ui-block-a" style="padding-top:0px;" >
              <a href="#popupBasic" data-rel="popup" id="m1" data-position-to="window"><img src="P2_3.png" id="menu1" width="45" height="45"></a>
             
             <div style="float:right;padding-top:9px;padding-right:12px;">
			 <a href="#" id="rdmBtn" align="right"><img src="P2_4.png" id="rdmIcon" width="35" height="29"></a>
               </div>
             
            </div>
      		<div class="ui-block-b" >
        		<div id="selectList">
           <select id="wpse" name="wpsen" multiple="multiple" data-native-menu="false" data-theme="b" data-mini="true"><option>請先搜尋路點</option></select>
     			</div>
     		</div>
      		<div class="ui-block-c" id="selectList2">
            <div style="float:right;padding-top:1px;">
             <a href="#" id="r1"><img src="P2_2.png" id="go1" width="45" height="45"></a>
             </div>
     		</div>
		</div >
        
        
        <div data-role="popup" id="popupBasic" class="ui-content" data-theme="b" data-overlay-theme="a">
			<a data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">關閉</a>
		
        起點：<br>
        <input type="text" id="start" data-mini="true">
        <a href="#" data-role="button" id="d1" data-inline="true" data-mini="true">現在位置</a>
        <a href="#" data-role="button" id="b1" data-inline="true" data-mini="true">確認起點</a>
        <br>
        終點：<br>
        <input type="text" id="end" data-mini="true">
        <a href="#" data-role="button" id="d2" data-inline="true" data-mini="true">現在位置</a>
        <a href="#" data-role="button" id="b2" data-inline="true" data-mini="true">確認終點</a><br><br>
        

        路點類型：<br>
        <select name="category" id="cate" data-native-menu="true" data-mini="true">
      			<option value="all">全部</option>
                <option value="Local business">商務</option>
      			<option value="Restaurant/cafe">餐廳</option>
      			<option value="Hotel">旅館</option>
                <option value="Travel/leisure">休閒</option>
                <option value="School">學校</option>
                <option value="Landmark">地標</option>
                <option value="Tours/sightseeing">觀光</option>
                <option value="Arts/entertainment/nightlife"> 娛樂</option>
                <option value="Shopping/retail">購物</option>
                <option value="Health/beauty">美容</option>
                <option value="Food/grocery">食品</option>
                <option value="Food/beverages">飲料</option>
                <option value="Clothing">服飾</option>
                <option value="Church/religious organization">宗教</option>
                <option value=" Museum/art gallery">博物館</option>
                <option value="Sports venue">體育館</option>
                <option value="Bar">酒吧</option>
                <option value="Club">俱樂部</option>
                <option value="Library">圖書館</option>
                <option value="Retail and consumer merchandise">零售店</option>
                <option value="Book store"> 書店</option>
                <option value="Government organization"> 政府</option>
                <option value="Movie theater"> 電影院</option>
                <option value="Jewelry/watches"> 珠寶</option>
                <option value="Hospital/clinic"> 院所</option>     
    	</select><br>
        路點關鍵字：<br>
        <input type="search" name="keyword" id="key" data-mini="true"><br>
        
        <a href="#" data-role="button" id="rwp" data-mini="true">搜尋路點</a><br>
        
        <div id="selectList0">
            
        </div>
          
		</div>
        
        
	</div> 
        
    <div role="main" class="ui-content" id="map-canvas">
    </div>
    
    <div data-role="content" style="height:33px;padding-top:0px;overflow:hidden;" id="ftr"> 
        <div  class="ui-grid-b">
            <div class="ui-block-a">
               <div align="left" id="ftrl" style="padding-top:2px; color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrl">
             
               </div>
            </div>
      		<div class="ui-block-b" >
               <div align="center" style="color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrm">
                <a href="#" data-role="button" id="run" data-mini="true" data-theme="b" data-inline="true">START</a>
               </div>
     		</div>
      		<div class="ui-block-c">
               <div align="right" style="padding-top:12px; color:white; text-shadow:1px  1px  1px  #dedede;" id="ftrr">

               </div>
     		</div>
		</div >
    
    
    
    
    </div>
</div>

<script>
var geocoder;
var map;
var directionsService;
var directionsDisplay=null;
var marker_s=null;
var marker_e=null;
var sp=null;
var ep=null;
var timeoutId = 0;
var timeoutId2 = 0;
var tctr=0;
var hh;
var mm;
var ss;
var dh;
var dm;
var ds;
var ttt;
var s_flag=0;
var marker_rt=null;
var rngMax;
var localLat=[];
var localLng=[];
var addr_s;
var addr_e;
var markerArray=[];
var stepDisplay;

$( document ).on( "pageinit", "#page_1", function() {

p1_resize();

});

$(window).resize(function() {
  p1_resize();
  var txe=window.innerHeight-98;
  $("#map-canvas").css({"height":txe+"px"});
  
});

$( document ).on( "pageinit", "#map-page", function() {
	
	var txe=window.innerHeight-98;
	$("#map-canvas").css({"height":txe+"px"});

	$("#wpse").selectmenu('disable');
	$("#run").addClass('ui-disabled');
	
	
    var defaultLatLng = new google.maps.LatLng(25.047968, 121.517081); 
	geocoder = new google.maps.Geocoder();
	directionsService = new google.maps.DirectionsService();
    
    drawMap(defaultLatLng); 
	stepDisplay = new google.maps.InfoWindow();
	

$("#d1").on( "click",function() {
    if ( navigator.geolocation ) {
        function success(pos) {
			 var latlng = new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
				     $("#start").val(results[0].formatted_address);
					}
                 } else {
                    alert("Geocoder failed due to: " + status);
                 }
             });
        }
        function fail(error) {
            alert("定位失敗!")
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    } else {
        alert("瀏覽器不支援或未開啟定位功能")
    }
});
		
$("#d2").on( "click",function() {
	  if ( navigator.geolocation ) {
        function success(pos) {
			var latlng = new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 geocoder.geocode({'latLng': latlng}, function(results, status) {
     			 if (status == google.maps.GeocoderStatus.OK) {
        			if (results[0]) {
				     $("#end").val(results[0].formatted_address);
					}
                 } else {
                    alert("Geocoder failed due to: " + status);
                 }
             });
        }
        function fail(error) {
            alert("定位失敗!")
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    } else {
        alert("瀏覽器不支援或未開啟定位功能")
    }          
});
		
$("#b1").on( "click",function() {
   var address = $("#start").val();
   addr_s=address;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        if(marker_s!=null)
		{
			marker_s.setMap(null);
			google.maps.event.trigger(map, "resize");
		}
		marker_s = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
		sp=results[0].geometry.location;
		
		$("#selectList0").html('');
		$("#wpse").off();
        $("#wpse").html('<option>請先搜尋路點</option>');
		$("#wpse").selectmenu('refresh');
		$("#wpse").selectmenu('disable');
		$("#r1").off();
		$("#rdmBtn").off();
		
						$("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
		
		
      } else {
        alert("Geocode was not successful for the following reason: " + status);
      }
    });
});
		
$("#b2").on( "click",function() {
   var address = $("#end").val();
   addr_e=address;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
		if(marker_e!=null)
		{
			marker_e.setMap(null);
			google.maps.event.trigger(map,"resize");
		}
        marker_e = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
		ep=results[0].geometry.location;
		
		$("#selectList0").html('');
		$("#wpse").off();
        $("#wpse").html('<option>請先搜尋路點</option>');
		$("#wpse").selectmenu('refresh');
		$("#wpse").selectmenu('disable');
		$("#r1").off();
		$("#rdmBtn").off();
		
		                $("#run").addClass('ui-disabled');
		 				$("#ftrr").html(""); 
						$('#ftrl').html("");
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
		
		
      } else {
        alert("Geocode was not successful for the following reason: " + status);
      }
    });
});
		

$("#rwp").on( "click",function() {
	
	        if((sp!=null)&&(ep!=null)){
                       $.ajax(
				 			{   url: '/proxy.php',
							    //async: false,
				     			type: 'GET',
	  				 			dataType: "json",
                     
                     			success: function(Jdata) { 
								 var dts;
								 var center;
								 var rad;
								 var li=20;
								 var tk=Jdata.result.token;						 
								 
								 if((ep.lat()==sp.lat())&&(ep.lng()==sp.lng())){
									 
								   center=sp.lat()+','+sp.lng(); 
								   rad=3;
								 
								   if(($("#key").val()=='')&&($("#cate").val()=='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:"",                                      category:""};
							       }else if(($("#key").val()!='')&&($("#cate").val()=='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:$("#key").val(),                                      category:""};
								   }else if(($("#key").val()=='')&&($("#cate").val()!='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:"",                                      category:$("#cate").val()};
								   }else if(($("#key").val()!='')&&($("#cate").val()!='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:$("#key").val(),                                      category:$("#cate").val() };
								   }
								 }else{
									
									 var lt=(sp.lat()+ep.lat())/2;
									 var lg=(sp.lng()+ep.lng())/2
									 
									 var step3=google.maps.geometry.spherical.computeDistanceBetween(sp,ep)/1000/2;
									 if(step3<1){step3=1;}
								   
								   
								   center=lt+','+lg; 
								   rad=step3;
								 
								   if(($("#key").val()=='')&&($("#cate").val()=='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:"",                                      category:""};
							       }else if(($("#key").val()!='')&&($("#cate").val()=='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:$("#key").val(),                                      category:""};
								   }else if(($("#key").val()=='')&&($("#cate").val()!='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:"",                                      category:$("#cate").val()};
								   }else if(($("#key").val()!='')&&($("#cate").val()!='all')){
									 dts={ coordinates: center, radius: rad, limit: li ,token:tk,keyword:$("#key").val(),                                      category:$("#cate").val() };
								   }
								   
								 }
								 
								 	$.ajax(
				 						{   url: '/proxy2.php',
							    			//async: false,
				     						type: 'POST',
											data:dts,
	  				 						dataType: "json",
                     						success: function(Jdata2) { 
											
											var rst=Jdata2.message;
											var ctr=Jdata2.total;
											var localName=[];
											localLat=[];
											localLng=[];
											var check=[];
											rngMax=ctr;
											
											for(i=0;i<ctr;i++){
							                    localLat[i]=Jdata2.result[i].latitude;
												localLng[i]=Jdata2.result[i].longitude;
												check[i]=Jdata2.result[i].checkins;
												localName[i]=Jdata2.result[i].name;
												localName[i]=localName[i].replace(/\\/g,"%");
												localName[i]=decodeURI(localName[i]);	
											}
											
											$("#selectList0").html('');
											$("#wpse").off();
        									$("#wpse").html('<option>請先搜尋路點</option>');
											$("#wpse").selectmenu('refresh');
											$("#wpse").selectmenu('disable');
											$("#r1").off();
											$("#rdmBtn").off();
											$("#run").addClass('ui-disabled');
		 				                    $("#ftrr").html(""); 
						                    $('#ftrl').html("");
		 				                    tctr=0;
		                                    s_flag=0;
						                    clearInterval(timeoutId);
			                                clearInterval(timeoutId2);
			                                if(marker_rt!=null)
					                       {
							                   marker_rt.setMap(null);
						                      google.maps.event.trigger(map, "resize");
						                   }
			                               $("#run").html('START');
						
						                   $("#run").off();
										   
										   if(directionsDisplay!=null)
											{
													directionsDisplay.setMap(null);
													google.maps.event.trigger(map,"resize");
											}
											google.maps.event.clearListeners(map, "click");
											for(p=0;p<markerArray.length;p++)
											{
													markerArray[p].setMap(null);
													google.maps.event.trigger(map, "resize");
											}
											markerArray=[];
										   
											
											if(rst=='no result'){
						
											  $("#selectList0").append('沒有找到任何路點');

											}else if(rst=='success')
											{
											  $("#selectList0").append('找到'+ctr+'個路點');
											  
											  $("#wpse").html('<option>請選擇最多六個路點</option>');
	
											  for(i=0;i<ctr;i++){
							                    $("#wpse").append('<option value="'+localLat[i]+','+localLng[i]+'">'+localName[i]+'&nbsp;&nbsp;&nbsp;&nbsp;人氣度:'+check[i]+'</option>');												
											  }
											  
											  
											  $("#wpse").selectmenu('refresh');
											  
											  $("#wpse").selectmenu('enable');
											  
											 	$("#wpse").on( "change",function () {
													$(this).selectmenu('refresh');
                                                var st=$(this).find("option:selected");
								                if (st.length>5) {
								                 $(this).selectmenu('close');
								                 $(this).selectmenu('disable');
                                                 } 
                                                });						  
										  
											  
	$("#rdmBtn").on( "click",function() {
		var crr;
		var haha=[];
		var tyu;
		var flg;
		var yoyo=[];
		
		if(rngMax>0)
		{
			if(rngMax<5)
			{
				crr=rng(1,rngMax);
			}else
			{
				crr=rng(1,5);
			}
			
			var hgh=0;
			
			while(hgh<crr)
			{
				tyu=rng(1,rngMax);
				flg=0;
				for(j=0;j<haha.length;j++)
				{
				   if(tyu==haha[j])
				   {
					   flg=1;   
				   }	
				}
				if(flg!=1)
				{
				  
				  haha.push(tyu);
				  hgh++;
				}
			}
			
			for(j=0;j<haha.length;j++)
			{
				   yoyo.push(localLat[haha[j]-1]+','+localLng[haha[j]-1]);
		    }
			
			$('#wpse').val(yoyo).selectmenu('refresh',true);
			
			$("#wpse").selectmenu('enable');
			
		}
		
		
		});										  



$("#r1").on( "click",function() {
      
	   var wayPnts=$("#wpse").val()||[];
	   var wptSend=[];
	   var request;
	   
	   if(wayPnts.length==0){
	    request = {
                origin: $("#start").val(),
                destination: $("#end").val(),
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
        };
		
	   }else if(wayPnts.length>0){
		   for(i=0;i<wayPnts.length;i++)
		   {
			   var xx;
			   var aa;
			   var bb;
			   var cc;
			   
			   xx=wayPnts[i].split(",");
			   aa=xx[0];
			   bb=xx[1];
			   
			   cc=new google.maps.LatLng(aa,bb); 
			   
			   wptSend.push({
          		location:cc,
          		stopover:true});
		   }
		   
		    request = {
                origin: $("#start").val(),
                destination: $("#end").val(),
				waypoints: wptSend,
				optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
            };
		   
		}
		
		directionsService.route(request, function(response, status) {
                //規畫路徑回傳結果
                if (status == google.maps.DirectionsStatus.OK) {
						if(directionsDisplay!=null)
						{
							directionsDisplay.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						
						if(marker_s!=null)
						{
							marker_s.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
						
						if(marker_e!=null)
						{
							marker_e.setMap(null);
							google.maps.event.trigger(map,"resize");
						}
	
    					
						var rendererOptions = {
  							map: map,
  							suppressMarkers : true
						}
						
						directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
						
						directionsDisplay.setMap(map);
						
                        directionsDisplay.setDirections(response);
						
						google.maps.event.clearListeners(map, "click");
						for(p=0;p<markerArray.length;p++)
						{
							markerArray[p].setMap(null);
							google.maps.event.trigger(map, "resize");
						}
						markerArray=[];
						
						
						var landNArray=[];
						var landLGG=[];
						 var icon_s="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=star|FF0000|000000";
						  var icon_e="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=flag|FF0000||000000";
						  var icon_f="https://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=glyphish_walk|6aad32|000000";
						 
						 var marker_temp_s = new google.maps.Marker({
                            position: sp, 
                            map: map,
                            icon: icon_s
                         });
						 
						 attachInstructionText(marker_temp_s, addr_s);
						 
						var marker_temp_e = new google.maps.Marker({
                            position: ep, 
                            map: map,
                            icon: icon_e
                         });
						
						attachInstructionText(marker_temp_e, addr_e);
						
						markerArray.push(marker_temp_s);
						markerArray.push(marker_temp_e);
						
						 $("#wpse option:selected").each(function(){
    							landNArray.push($(this).text());
								landLGG.push($(this).val());
  						 });
						 
						 for(k=0;k<landNArray.length;k++)
						 {
							var xxx=landLGG[k].split(",");
			                var aaa=xxx[0];
			                var bbb=xxx[1];
			   
			                var ccc=new google.maps.LatLng(aaa,bbb); 
							
							
							 var marker_temp= new google.maps.Marker({
                           		 position: ccc, 
                            	 map: map,
                            	 icon: icon_f
                         	});
							 
							 attachInstructionText(marker_temp,landNArray[k]);
						
						     markerArray.push(marker_temp);
							 
						 }
						
						
						
						
						
						 var totalDistance = 0;
   						 var totalDuration = 0;
                         var legs = response.routes[0].legs;
                         for(var i=0; i<legs.length; ++i) {
                             totalDistance += legs[i].distance.value;
                             totalDuration += legs[i].duration.value;
                         }
						 
						 totalDistance/=1000;
						 totalDistance=parseInt(totalDistance);
						 totalDuration/=60;
						 totalDuration=parseInt(totalDuration);
						 
                         $('#ftrl').html(totalDistance+"公里<br>"+totalDuration+"分鐘");
						
						$("#run").removeClass('ui-disabled');
		 				$("#ftrr").html("00:00:00&nbsp;"); 
		 				tctr=0;
		                s_flag=0;
						clearInterval(timeoutId);
			            clearInterval(timeoutId2);
			            if(marker_rt!=null)
					    {
							marker_rt.setMap(null);
							google.maps.event.trigger(map, "resize");
						}
			            $("#run").html('START');
						
						$("#run").off();
						
		
		                $("#run").on( "click",function() {
		    
                            if(s_flag==0){
			 
			                timeoutId = setInterval(function(){time();},1000);
			                timeoutId2 = setInterval(function(){realTime();},6500);
			                $("#run").html('STOP');
			 
			                 s_flag=1;
			 
			                }else if(s_flag==1){
			 
			                   clearInterval(timeoutId);
			                   clearInterval(timeoutId2);
			                   if(marker_rt!=null)
							   {
									marker_rt.setMap(null);
									google.maps.event.trigger(map, "resize");
								}
			                   $("#run").html('START');
			 
			                   s_flag=0;
			                }
		 
		 
		                 });
		
						
						
						
                }
        });
		
		
		
		
});
											  
											  
											}
											
											
											
											},
											error: function(xhr, ajaxOptions, thrownError) {
									           alert(thrownError);
                     			            }
									     });
								 
								 
                    			 },
                     			error: function(xhr, ajaxOptions, thrownError) {
									alert(thrownError);
                     			}
                 		 });
			}

});





});

function drawMap(latlng) {
        var myOptions = {
            zoom: 15,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
       map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
    }
	

function time() {
			 tctr+=1;
			 ttt=tctr; 
		     hh=parseInt(ttt/3600);
			 ttt-=(hh*3600);
			 mm=parseInt(ttt/60);
			 ttt-=(mm*60);
			 ss=ttt;
			 
			 if(hh<10)
			 {
				 dh="0"+hh+":";
			 }else
			 {
				 dh=hh+":";
			 }
			 
			 if(mm<10)
			 {
				 dm="0"+mm+":";
			 }else
			 {
				 dm=mm+":";
			 }
			 
			  if(ss<10)
			 {
				 ds="0"+ss+"&nbsp;";
			 }else
			 {
				 ds=ss+"&nbsp;";
			 }
			 
			 
			 $("#ftrr").html(dh+dm+ds);
}

function realTime()
{
	 
	 if ( navigator.geolocation ) {
        function success(pos) {
			 var rt= new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
			 map.setCenter(rt);
			 if(marker_rt!=null)
			{
				marker_rt.setMap(null);
				google.maps.event.trigger(map, "resize");
			}
				marker_rt = new google.maps.Marker({
            			map: map,
            			position: rt
        		});
			
			
        }
        function fail(error) {
            
        }
        // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
        navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 0, enableHighAccuracy:true, timeout: 6000});
    } else {
        alert("瀏覽器不支援或未開啟定位功能")
    }
	


}

function rng(minN,maxN)
{

  var nb = Math.floor(Math.random() * (maxN - minN + 1)) + minN;  
  return nb;
}

 function attachInstructionText(markerr, text) {
    google.maps.event.addListener(markerr, 'click', function() {
      // Open an info window when the marker is clicked on,
      // containing the text of the step.
      stepDisplay.setContent(text);
      stepDisplay.open(map, markerr);
    });
  }
  
  function p1_resize()
{
var logo_w=353;
var logo_h=66;
var go_w=431;
var go_h=383;
var his_w=443;
var his_h=95;
var set_w=443;
var set_h=96;
var txe0=window.innerHeight;


var sum=logo_h+go_h+his_h+go_h+160;
var per=txe0/sum;
logo_w=logo_w*per;
logo_h=logo_h*per;
go_w=go_w*per;
go_h=go_h*per;
his_w=his_w*per;
his_h=his_h*per;
set_w=set_w*per;
set_h=set_h*per;



$("#lgo").css({"width":logo_w+"px"});
$("#lgo").css({"height":logo_h+"px"});
$("#lgo_go").css({"width":go_w+"px"});
$("#lgo_go").css({"height":go_h+"px"});
$("#lgo_his").css({"width":his_w+"px"});
$("#lgo_his").css({"height":his_h+"px"});
$("#lgo_set").css({"width":set_w+"px"});
$("#lgo_set").css({"height":set_h+"px"});

	
}


</script>

</body>
</html>
